<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>琰琰 圣诞快乐</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: radial-gradient(circle at top, #281032, #050515 70%, #000000);
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
      color: #ffeefe;
    }
    canvas {
      display: block;
      width: 100%;
      height: 100%;
    }
    .greeting {
      position: fixed;
      top: 5%;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      pointer-events: none;
      text-shadow: 0 0 12px rgba(255, 150, 230, 0.95);
      z-index: 2;
    }
    .greeting-main {
      font-size: clamp(26px, 5vw, 40px);
      font-weight: 700;
      letter-spacing: 0.15em;
    }
    .greeting-sub {
      margin-top: 6px;
      font-size: clamp(16px, 3.2vw, 22px);
      opacity: 0.9;
    }
    .footer-note {
      position: fixed;
      bottom: 6px;
      right: 10px;
      font-size: 10px;
      opacity: 0.35;
      pointer-events: none;
      z-index: 2;
    }
  </style>
</head>
<body>
  <div class="greeting">
    <div class="greeting-main">琰琰 圣诞快乐</div>
    <div class="greeting-sub">Merry Christmas ✨</div>
  </div>
  <div class="footer-note">for 琰琰</div>

  <canvas id="treeCanvas"></canvas>

  <script>
    (function () {
      var canvas = document.getElementById("treeCanvas");
      var ctx = canvas.getContext("2d");

      var W, H, cx, baseY, treeH;
      var rings = [];       // 树的每一层光环
      var groundRing = [];  // 地面那一圈光
      var snow = [];
      var lastTime = performance.now();

      function resize() {
        W = window.innerWidth || document.documentElement.clientWidth;
        H = window.innerHeight || document.documentElement.clientHeight;

        var dpr = window.devicePixelRatio || 1;
        canvas.width = W * dpr;
        canvas.height = H * dpr;
        canvas.style.width = W + "px";
        canvas.style.height = H + "px";
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

        cx = W / 2;
        baseY = H * 0.8;
        treeH = H * 0.6;

        createTreeRings();
        createGroundRing();
        createSnow();
      }

      window.addEventListener("resize", resize);
      resize();

      function rand(min, max) {
        return Math.random() * (max - min) + min;
      }

      // 一层一层的树光环
      function createTreeRings() {
        rings = [];
        var layerCount = 30; // 层数
        var pointsPerLayer = 140; // 每层粒子数

        for (var i = 0; i < layerCount; i++) {
          var t = i / (layerCount - 1); // 0 顶部 1 底部
          var height = baseY - (1 - t) * treeH; // 顶部高，底部低

          // radius: 底部最大，顶部最小（树是三角形）
          var radius = (0.15 + 0.85 * t) * (W * 0.23);

          var layer = [];
          for (var j = 0; j < pointsPerLayer; j++) {
            var angle = (j / pointsPerLayer) * Math.PI * 2;
            layer.push({
              angle: angle,
              radius: radius + rand(-6, 6),
              height: height + rand(-3, 3),
              twinkleSpeed: rand(1.5, 3.5),
              phase: rand(0, Math.PI * 2),
              baseAlpha: rand(0.4, 0.8),
              size: rand(1.2, 2.4)
            });
          }
          rings.push(layer);
        }
      }

      // 地面一圈发光粒子
      function createGroundRing() {
        groundRing = [];
        var count = 260;
        var radius = W * 0.35;
        var y = baseY + 10;
        for (var i = 0; i < count; i++) {
          var angle = (i / count) * Math.PI * 2;
          groundRing.push({
            angle: angle,
            radius: radius + rand(-10, 10),
            height: y + rand(-4, 4),
            size: rand(1.5, 2.5),
            baseAlpha: rand(0.2, 0.5),
            phase: rand(0, Math.PI * 2)
          });
        }
      }

      // 雪花
      function createSnow() {
        snow = [];
        var count = Math.floor(650 * (W * H) / (800 * 600));
        for (var i = 0; i < count; i++) {
          snow.push({
            x: rand(0, W),
            y: rand(-H, H),
            vy: rand(30, 90),
            amp: rand(5, 20),
            phase: rand(0, Math.PI * 2),
            size: rand(0.8, 1.8)
          });
        }
      }

      function drawBackground() {
        ctx.fillStyle = "#050515";
        ctx.fillRect(0, 0, W, H);

        // 地面柔光
        var grd = ctx.createRadialGradient(
          cx, baseY + 20, 10,
          cx, baseY + 20, W * 0.75
        );
        grd.addColorStop(0, "rgba(255,210,250,0.45)");
        grd.addColorStop(0.4, "rgba(255,190,245,0.25)");
        grd.addColorStop(1, "rgba(0,0,0,0)");
        ctx.fillStyle = grd;
        ctx.beginPath();
        ctx.arc(cx, baseY + 20, W * 0.75, 0, Math.PI * 2);
        ctx.fill();
      }

      function drawTrunk() {
        var tw = Math.max(18, W * 0.02);
        var th = Math.max(50, H * 0.09);
        ctx.fillStyle = "#8a5538";
        ctx.fillRect(cx - tw / 2, baseY, tw, th);
      }

      function drawStar(t) {
        var topY = baseY - treeH;
        var baseR = Math.max(10, Math.min(W, H) * 0.02);
        var pulse = 1 + 0.2 * Math.sin(t * 3);
        var outer = baseR * pulse;
        var inner = outer * 0.5;

        var g = ctx.createRadialGradient(
          cx, topY, 0,
          cx, topY, outer * 4
        );
        g.addColorStop(0, "rgba(255,255,210,0.98)");
        g.addColorStop(1, "rgba(255,255,210,0)");
        ctx.fillStyle = g;
        ctx.beginPath();
        ctx.arc(cx, topY, outer * 4, 0, Math.PI * 2);
        ctx.fill();

        ctx.save();
        ctx.translate(cx, topY);
        ctx.rotate(t * 0.5);
        ctx.beginPath();
        var spikes = 5;
        for (var i = 0; i < spikes * 2; i++) {
          var r = (i % 2 === 0) ? outer : inner;
          var ang = (i * Math.PI) / spikes;
          var x = Math.cos(ang) * r;
          var y = Math.sin(ang) * r;
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        }
        ctx.closePath();
        ctx.fillStyle = "rgba(255,255,235,1)";
        ctx.fill();
        ctx.restore();
      }

      function loop(now) {
        var dt = (now - lastTime) / 1000;
        if (dt > 0.05) dt = 0.05;
        lastTime = now;
        var t = now / 1000;

        drawBackground();
        drawTrunk();

        // 雪
        for (var i = 0; i < snow.length; i++) {
          var s = snow[i];
          s.y += s.vy * dt;
          s.x += Math.sin(t * 1.5 + s.phase) * s.amp * dt;

          if (s.y > H + 10) {
            s.y = rand(-50, -10);
            s.x = rand(0, W);
          }
          if (s.x < -20) s.x = W + 20;
          if (s.x > W + 20) s.x = -20;

          ctx.beginPath();
          ctx.fillStyle = "rgba(235,235,255,0.9)";
          ctx.arc(s.x, s.y, s.size, 0, Math.PI * 2);
          ctx.fill();
        }

        // 地面光环粒子缓慢旋转
        for (i = 0; i < groundRing.length; i++) {
          var gP = groundRing[i];
          var angle = gP.angle + t * 0.15;
          var gx = cx + Math.cos(angle) * gP.radius;
          var gy = gP.height;
          var alphaG = gP.baseAlpha + 0.2 * Math.sin(t * 2 + gP.phase);
          if (alphaG < 0.05) alphaG = 0.05;
          if (alphaG > 0.6) alphaG = 0.6;

          ctx.beginPath();
          ctx.fillStyle = "rgba(255,200,250," + alphaG + ")";
          ctx.arc(gx, gy, gP.size, 0, Math.PI * 2);
          ctx.fill();
        }

        // 树的每一层光环（整体在旋转）
        for (var li = 0; li < rings.length; li++) {
          var layer = rings[li];
          for (var j = 0; j < layer.length; j++) {
            var p = layer[j];

            // 基础旋转，让整层环绕转动
            var angle = p.angle + t * 0.4;
            // 用 cos(angle) 做「3D 透视」：靠前更亮、更大
            var depth = (Math.cos(angle) + 1) / 2; // 0~1，1 表示离我们最近

            var radiusOnScreen = p.radius * (0.4 + 0.6 * depth);
            var x = cx + Math.sin(angle) * radiusOnScreen;
            var y = p.height + (1 - depth) * 10; // 远处稍微往上

            // 闪烁 + 深度混合
            var alpha = p.baseAlpha + 0.4 * Math.sin(t * p.twinkleSpeed + p.phase);
            alpha = alpha * (0.3 + 0.7 * depth);
            if (alpha < 0.08) alpha = 0.08;
            if (alpha > 1) alpha = 1;

            var size = p.size * (0.7 + 0.8 * depth);

            ctx.beginPath();
            ctx.fillStyle = "rgba(255, " + Math.round(150 + depth * 80) +
                            ", 240," + alpha + ")";
            ctx.arc(x, y, size, 0, Math.PI * 2);
            ctx.fill();
          }
        }

        drawStar(t);
        requestAnimationFrame(loop);
      }

      requestAnimationFrame(loop);
    })();
  </script>
</body>
</html>
