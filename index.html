import pygame
import random
import math
import sys

# 初始化pygame
pygame.init()

# 设置窗口尺寸
WIDTH, HEIGHT = 800, 600
screen = pygame.display.set_mode((WIDTH, HEIGHT))
pygame.display.set_caption("Python圣诞树 - 动态雪花效果")

# 颜色定义
DARK_GREEN = (0, 100, 0)
GREEN = (0, 150, 0)
LIGHT_GREEN = (100, 200, 100)
BROWN = (139, 69, 19)
RED = (255, 0, 0)
BLUE = (0, 0, 255)
YELLOW = (255, 255, 0)
PURPLE = (128, 0, 128)
WHITE = (255, 255, 255)
GOLD = (255, 215, 0)

# 雪花类
class Snowflake:
    def __init__(self):
        self.x = random.randint(0, WIDTH)
        self.y = random.randint(-100, 0)
        self.size = random.randint(2, 5)
        self.speed = random.uniform(1, 3)
        self.wind = random.uniform(-0.5, 0.5)
        self.angle = random.uniform(0, 2 * math.pi)
        self.rotation_speed = random.uniform(-0.05, 0.05)
        
    def update(self):
        self.y += self.speed
        self.x += self.wind
        self.angle += self.rotation_speed
        
        # 如果雪花飘出屏幕，重新生成一个
        if self.y > HEIGHT:
            self.y = random.randint(-100, 0)
            self.x = random.randint(0, WIDTH)
            
    def draw(self):
        # 绘制六角雪花
        points = []
        for i in range(6):
            angle = self.angle + i * math.pi / 3
            px = self.x + self.size * math.cos(angle)
            py = self.y + self.size * math.sin(angle)
            points.append((px, py))
            
        pygame.draw.polygon(screen, WHITE, points)

# 创建雪花
snowflakes = [Snowflake() for _ in range(150)]

# 绘制圣诞树函数
def draw_tree():
    # 绘制树干
    pygame.draw.rect(screen, BROWN, (WIDTH//2 - 20, HEIGHT//2 + 100, 40, 100))
    
    # 绘制树层
    layers = [
        (WIDTH//2, HEIGHT//2 - 100, 180),
        (WIDTH//2, HEIGHT//2, 150),
        (WIDTH//2, HEIGHT//2 + 80, 120)
    ]
    
    for x, y, width in layers:
        pygame.draw.polygon(screen, GREEN, [
            (x - width//2, y),
            (x, y - 80),
            (x + width//2, y)
        ])
        pygame.draw.polygon(screen, LIGHT_GREEN, [
            (x - width//2 + 10, y),
            (x, y - 70),
            (x + width//2 - 10, y)
        ])
    
    # 绘制装饰球
    ornaments = [
        (WIDTH//2 - 60, HEIGHT//2 - 60, RED),
        (WIDTH//2 + 60, HEIGHT//2 - 40, BLUE),
        (WIDTH//2 - 40, HEIGHT//2 + 20, YELLOW),
        (WIDTH//2 + 40, HEIGHT//2 + 60, PURPLE),
        (WIDTH//2, HEIGHT//2 - 120, GOLD)
    ]
    
    for x, y, color in ornaments:
        pygame.draw.circle(screen, color, (x, y), 10)
        pygame.draw.circle(screen, WHITE, (x, y), 10, 2)
    
    # 绘制树顶星星
    star_points = []
    for i in range(5):
        # 外点
        angle = math.pi/2 + i * 2*math.pi/5
        px = WIDTH//2 + 20 * math.cos(angle)
        py = HEIGHT//2 - 180 + 20 * math.sin(angle)
        star_points.append((px, py))
        
        # 内点
        angle = math.pi/2 + (i + 0.5) * 2*math.pi/5
        px = WIDTH//2 + 10 * math.cos(angle)
        py = HEIGHT//2 - 180 + 10 * math.sin(angle)
        star_points.append((px, py))
    
    pygame.draw.polygon(screen, GOLD, star_points)

# 绘制文字
def draw_text():
    font = pygame.font.SysFont('simhei', 36)
    text = font.render("Merry Christmas!", True, WHITE)
    screen.blit(text, (WIDTH//2 - text.get_width()//2, 30))
    
    font_small = pygame.font.SysFont('simhei', 20)
    text2 = font_small.render("Python圣诞树 - 从代码到浪漫", True, WHITE)
    screen.blit(text2, (WIDTH//2 - text2.get_width()//2, HEIGHT - 50))

# 主循环
clock = pygame.time.Clock()
running = True

while running:
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False
    
    # 填充深蓝色背景
    screen.fill((0, 0, 50))
    
    # 更新并绘制所有雪花
    for snowflake in snowflakes:
        snowflake.update()
        snowflake.draw()
    
    # 绘制圣诞树
    draw_tree()
    
    # 绘制文字
    draw_text()
    
    pygame.display.flip()
    clock.tick(30)

pygame.quit()
sys.exit()
